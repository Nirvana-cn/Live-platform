<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live</title>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
</head>
<body>
<p>webRTC demo</p>
<video id="local" autoplay playsinline></video>
<div id="content">
    <p>可用设备如下</p>
</div>
</body>
<script>
    var video = document.getElementById('local');
    var content = document.getElementById("content")
    var constraints = window.constraints = {
        video: true
    };
    navigator.mediaDevices.enumerateDevices()
        .then(function (devices) {
            devices.forEach(function (device) {
                let str = device.kind + ": " + device.label + " id = " + device.deviceId;
                console.log(str)
                let child = document.createTextNode(str);
                content.appendChild(child);
                let br = document.createElement('br');
                content.appendChild(br);
            });
        })
        .catch(function (err) {
            console.log(err.name + ": " + err.message);
        });
    navigator.mediaDevices.getUserMedia(constraints).then(handleSuccess).catch(handleError);

    function handleSuccess(stream) {
        var videoTracks = stream.getVideoTracks();
        console.log('Got stream with constraints:', constraints);
        console.log('Using video device: ' + videoTracks[0].label);
        stream.oninactive = function () {
            console.log('Stream inactive');
        };
        window.stream = stream; // make variable available to browser console
        video.srcObject = stream;
    }

    function handleError(error) {
        if (error.name === 'ConstraintNotSatisfiedError') {
            errorMsg('The resolution ' + constraints.video.width.exact + 'x' +
                constraints.video.width.exact + ' px is not supported by your device.');
        } else if (error.name === 'PermissionDeniedError') {
            errorMsg('Permissions have not been granted to use your camera and ' +
                'microphone, you need to allow the page access to your devices in ' +
                'order for the demo to work.');
        }
        errorMsg('getUserMedia error: ' + error.name, error);
    }

    function errorMsg(msg, error) {
        errorElement.innerHTML += '<p>' + msg + '</p>';
        if (typeof error !== 'undefined') {
            console.error(error);
        }
    }

</script>
</html>